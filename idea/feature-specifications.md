# Encore - 機能仕様書

## 1. URL保存機能

### 基本機能
- **URL入力**: 手動でURLを入力して保存
- **段階的メタデータ取得**: 
  - Phase 1: 自前実装によるOGP/メタタグ解析
  - Phase 2: 失敗時の外部API（Microlink等）フォールバック
  - Phase 3: 特定サイト専用パーサー（GitHub、YouTube等）
- **保存データ**: 
  - URL（必須）
  - タイトル（自動取得、手動編集可）
  - サムネイル画像（OGP画像）
  - 説明文（メタディスクリプション）
  - サイト名・ファビコン
  - 保存日時（自動）
  - メモ（任意）

### メタデータ取得仕様

#### Phase 1: 自前実装
- **対象メタタグ**: 
  - `og:title`, `og:description`, `og:image`, `og:url`
  - `twitter:title`, `twitter:description`, `twitter:image`
  - `<title>`, `<meta name="description">`
  - `<link rel="canonical">`, `<link rel="icon">`
- **User-Agent**: カスタムBot識別
- **タイムアウト**: 10秒
- **エラー処理**: graceful fallback

#### Phase 2: 外部APIフォールバック
- **利用サービス**: 
  - Microlink API (無料枠あり)
  - LinkPreview API (バックアップ)
- **フォールバック条件**: タイトルが取得できない場合
- **環境変数制御**: `FALLBACK_API_ENABLED=true/false`

#### Phase 3: 特定サイト専用パーサー
- **GitHub**: リポジトリ情報、言語、スター数
- **YouTube**: 動画情報、再生時間、チャンネル
- **Twitter/X**: 基本ツイート情報、自動タグ付け
- **Qiita/Zenn**: 技術記事情報、タグ
- **追加予定**: Stack Overflow、Medium等

### UI/UX仕様
- 保存フォームは最小限の入力項目
- URLペースト時の自動プレビュー表示（リアルタイム）
- メタデータ取得中の視覚的フィードバック
- 取得失敗時の手動入力フォールバック
- 保存完了の視覚的フィードバック

## 2. タグ・カテゴリ機能

### タグシステム
- **自由タグ**: ユーザーが任意に設定
- **事前定義カテゴリ**: 技術、デザイン、ニュース、エンタメ等
- **タグサジェスト**: 既存タグからの候補表示
- **タグ階層**: 親子関係での整理（例: 技術 > Frontend > React）

### 管理機能
- タグ一覧表示
- タグ名変更・統合
- 使用頻度に基づくタグ並び替え

## 3. 検索・フィルタリング機能

### 検索機能
- **全文検索**: タイトル、URL、メモから検索
- **タグ検索**: タグでの絞り込み
- **複合検索**: タグ + キーワードの組み合わせ
- **検索履歴**: よく使う検索条件の保存

### フィルタリング
- 保存日時（今日、今週、今月、カスタム期間）
- お気に入り・ピン留めの絞り込み
- 未読・既読のステータス
- タグによる絞り込み

## 4. お気に入り・ピン留め機能

### お気に入り
- **ワンクリック追加**: ハートアイコンでの簡単追加
- **お気に入り一覧**: 専用ページでの管理
- **重要度**: 5段階評価システム

### ピン留め
- **上部固定**: 重要な記事を常に上部に表示
- **ピン留め数制限**: 5件程度の制限で厳選を促す
- **期限設定**: 自動でピン留め解除する日時設定

## 5. モバイル対応UI

### レスポンシブデザイン
- **モバイルファースト**: スマートフォンでの利用を最優先
- **片手操作**: 重要な操作は画面下部に配置
- **スワイプジェスチャー**: 削除、お気に入り切り替え
- **無限スクロール**: ページネーションより継続的な閲覧体験

### パフォーマンス
- 画像の遅延読み込み
- Virtual scrollingでの高速表示
- オフライン対応（PWA化検討）

## 6. Chrome拡張機能

### 基本機能
- **ワンクリック保存**: 現在のページを即座に保存
- **右クリックメニュー**: コンテキストメニューからの保存
- **ショートカットキー**: Ctrl+Shift+Sでの保存
- **保存確認**: 拡張機能上での保存成功表示

### 高度な機能
- **選択テキスト保存**: 選択したテキストをメモとして追加
- **一括保存**: 開いている複数タブの一括保存
- **タグプリセット**: 特定サイト用の自動タグ付け

## 7. X（Twitter）連携機能

### Phase 1: URL解析ベース（MVP）
- **ツイートURL判定**: X/TwitterのURL形式を検出
- **基本情報保存**: URL、タイトル、基本メタデータ
- **手動タグ付け**: 「Twitter」タグの自動付与
- **プレビュー表示**: URLからのembed表示

### 実装方式（Phase 1）
```typescript
// ツイートURL判定
function isTwitterUrl(url: string): boolean {
  return /^https?:\/\/(twitter\.com|x\.com)\/\w+\/status\/\d+/.test(url)
}

// 基本メタデータ取得（通常のOGPベース）
async function getTwitterMetadata(url: string) {
  // 通常のメタデータ取得
  const metadata = await extractMetadata(url)
  
  // Twitter専用の処理
  if (isTwitterUrl(url)) {
    metadata.tags = ['Twitter', ...(metadata.tags || [])]
    metadata.type = 'tweet'
  }
  
  return metadata
}
```

### Phase 2: API連携オプション（将来機能）
- **Twitter API v2 連携**: 有料プランまたは制限内での利用
- **詳細情報取得**: スレッド、リプライ、詳細統計
- **メディア保存**: 画像・動画の自動ダウンロード
- **リアルタイム更新**: いいね数、RT数の更新

### API連携の制約と対策
- **Freeプラン制限**: 月100ツイート取得まで
- **段階的導入**: 重要なツイートのみAPI使用
- **フォールバック**: APIエラー時はURL保存に切り替え
- **ユーザー選択**: API使用の有効/無効をユーザーが選択可能

## 8. 認証・アクセス制御

### Google認証
- **OAuth 2.0**: Supabase Auth経由
- **ホワイトリスト**: 許可されたメールアドレスのみ
- **自動ログアウト**: セキュリティ考慮の定期ログアウト

### 権限管理
- **個人データ**: 基本的に本人のみアクセス可
- **共有機能**: 限定的な記事共有（将来的に検討）

## 9. データ管理・エクスポート

### バックアップ
- **自動バックアップ**: 定期的なデータエクスポート
- **JSON形式**: 標準形式での出力
- **選択エクスポート**: タグ・期間指定での部分エクスポート

### インポート
- **他サービス連携**: Pocket、はてなブックマークからの移行
- **ブラウザブックマーク**: HTMLファイルからのインポート