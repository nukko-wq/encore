# Encore - 開発ロードマップ

## 開発の全体方針

### MVP（Minimum Viable Product）アプローチ
1. **コア機能を最優先**: URL保存・閲覧・基本管理機能
2. **段階的機能追加**: フェーズ毎に価値のある機能を追加
3. **ユーザビリティ重視**: 個人利用での使いやすさを最優先
4. **技術的品質**: 保守性・拡張性を考慮した設計

## Phase 1: MVP開発 (4-6週間)

### Week 1-2: 基盤構築
**目標**: プロジェクト基盤とBasic認証の完成

#### 必須タスク
- [x] プロジェクトセットアップ（Next.js + TypeScript + Tailwind）
- [ ] Supabase プロジェクトセットアップ
- [ ] データベーススキーマ作成（users, bookmarks, whitelist_emails）
- [ ] Supabase Auth + Google Provider 実装
- [ ] ホワイトリストテーブル(allowed_emails)作成
- [ ] RLSポリシー設定
- [ ] ホワイトリスト機能実装
- [ ] 基本的なUI/UXコンポーネント作成

#### 成果物
- Supabase Auth + Google認証機能付きの基本アプリケーション
- Supabase データベース基盤（RLSポリシー連携）
- ホワイトリストベースのアクセス制御（二重チェック）
- 基本UI コンポーネントライブラリ

### Week 3-4: コア機能開発
**目標**: ブックマーク機能の完成

#### 必須タスク
- [ ] URL保存機能（手動入力）
- [ ] Phase 1: Edge超軽量メタデータ取得実装（HTMLRewriter使用）
- [ ] メタデータ取得API エンドポイント（/api/extract）
- [ ] ブックマーク一覧表示
- [ ] ブックマーク詳細表示
- [ ] ブックマーク削除機能
- [ ] 基本的なレスポンシブ対応

#### 成果物
- 基本的なブックマーク管理アプリ
- Phase 1 Edge超軽量メタデータ取得システム（HTMLRewriter）

### Week 5-6: UI/UX改善 + Phase 2 メタデータ対応
**目標**: 実用的なアプリケーション + フォールバック機能

#### 必須タスク
- [ ] モバイル UI の最適化
- [ ] Phase 2: Node精度重視メタデータ取得実装（/api/extract/deep）
- [ ] metascraper + Readability統合実装
- [ ] Phase 3: 外部APIフォールバック実装（/api/extract/external）
- [ ] 段階的メタデータ取得フォールバックロジック
- [ ] パフォーマンス最適化（画像遅延読み込み等）
- [ ] エラーハンドリング改善
- [ ] ローディング状態の実装
- [ ] 基本的なテスト実装
- [ ] Vercel デプロイ設定

#### 成果物
- 実用レベルのMVPアプリケーション
- 三段構えメタデータ取得システム（Edge→Node→External API）

## Phase 2: 管理機能強化 (3-4週間)

### Week 1-2: タグ・カテゴリ機能
**目標**: 整理機能の完成

#### タスク
- [ ] タグシステムの実装
- [ ] タグ作成・編集・削除機能
- [ ] ブックマークへのタグ付け機能
- [ ] タグ一覧・管理画面
- [ ] タグ階層構造の検討・実装

### Week 3-4: 検索・フィルタ機能
**目標**: 効率的な情報検索の実現

#### タスク
- [ ] 日本語対応全文検索機能（PostgreSQL Trigram）
- [ ] pg_trgm拡張の有効化とインデックス作成
- [ ] search_bookmarks_trigram()ストアドファンクション実装
- [ ] タグによるフィルタリング
- [ ] 複合検索（キーワード + タグ）
- [ ] 保存日時によるフィルタ
- [ ] 検索結果の類似度ソート機能
- [ ] ILIKE検索フォールバック機能

## Phase 3: UX向上機能 (3-4週間)

### Week 1-2: お気に入り・ピン留め機能
**目標**: 重要度による管理機能

#### タスク
- [ ] お気に入り機能
- [ ] ピン留め機能
- [ ] お気に入り専用ページ
- [ ] ピン留めアイテムの上部固定表示
- [ ] 一括操作機能

### Week 3-4: UI/UX最適化
**目標**: 使いやすさの向上

#### タスク
- [ ] 無限スクロール実装
- [ ] スワイプジェスチャー対応
- [ ] ショートカットキー対応
- [ ] ダークモード実装
- [ ] アニメーション・トランジション改善

## Phase 4: 拡張機能開発 (4-5週間)

### Week 1-2: Chrome拡張機能
**目標**: ワンクリック保存の実現

#### タスク
- [ ] Chrome拡張機能 manifest 作成
- [ ] ポップアップUI実装
- [ ] 現在ページの保存機能
- [ ] 右クリックメニュー追加
- [ ] ショートカットキー対応
- [ ] Chrome Web Store 公開準備

### Week 3-4: Phase 3 特定サイト対応
**目標**: 特定サイト専用パーサーの実装

#### タスク
- [ ] 特定サイト専用パーサー実装（site-handlers.ts）
- [ ] X/Twitter URL判定・自動タグ付け
- [ ] GitHub リポジトリ情報取得パーサー
- [ ] YouTube 動画情報取得パーサー
- [ ] Qiita/Zenn 技術記事情報パーサー
- [ ] サイト別プレビュー表示改善
- [ ] Chrome拡張での特定サイト保存最適化
- [ ] メタデータキャッシュシステム（link_previewsテーブル）

### Week 5: PWA対応
**目標**: モバイルアプリ体験の実現

#### タスク
- [ ] Service Worker実装
- [ ] オフライン対応
- [ ] プッシュ通知（将来機能）
- [ ] アプリインストール対応

## Phase 5: 高度な機能・API連携 (オプション)

### Twitter API v2 連携（有料プラン対応）
**目標**: Twitter APIを活用した高度な機能

#### タスク
- [ ] Twitter API v2 設定・認証
- [ ] API使用量監視システム
- [ ] 詳細ツイート情報取得
- [ ] スレッド・リプライ情報保存
- [ ] メディア（画像・動画）自動保存
- [ ] ユーザー設定（API使用ON/OFF）
- [ ] フォールバック機能（APIエラー時の処理）

### その他のAPI連携
- [ ] YouTube API（動画情報詳細取得）
- [ ] GitHub API（リポジトリ情報）
- [ ] Pocket API（インポート機能）

## Phase 6: 最適化・改善 (継続的)

### パフォーマンス最適化
- [ ] データベースクエリ最適化
- [ ] 画像最適化（WebP対応、サイズ最適化）
- [ ] CDN活用
- [ ] キャッシュ戦略改善
- [ ] バンドルサイズ最適化

### セキュリティ強化
- [ ] セキュリティヘッダー強化
- [ ] Rate limiting 実装
- [ ] データ暗号化
- [ ] 脆弱性スキャン

### 運用・監視
- [ ] エラートラッキング（Sentry等）
- [ ] 分析ツール導入
- [ ] ヘルスチェック機能
- [ ] バックアップ自動化

## 各フェーズの判定基準

### Phase 1 完了条件
- [ ] Supabase Auth + Google認証でログインできる
- [ ] ホワイトリストによるアクセス制御が動作（Authフック + RLS）
- [ ] セッション管理がSupabase Authで正常動作
- [ ] URL保存・表示・削除ができる
- [ ] 三段構えメタデータ取得が安定動作（Edge→Node→External API）
- [ ] Edge抽出成功率80%以上達成
- [ ] モバイルで基本操作ができる

### Phase 2 完了条件
- [ ] タグの作成・編集・削除ができる
- [ ] ブックマークにタグ付けできる
- [ ] タグでフィルタリングできる
- [ ] 日本語キーワード検索ができる（Trigram）
- [ ] 検索結果を類似度でソートできる
- [ ] 検索フォールバック機能が動作する

### Phase 3 完了条件
- [ ] お気に入り・ピン留め機能が動作
- [ ] 無限スクロールが動作
- [ ] スワイプで操作できる
- [ ] ダークモードが切り替えられる

### Phase 4 完了条件
- [ ] Chrome拡張機能でページ保存できる
- [ ] Phase 3 特定サイト専用パーサーが動作
- [ ] X/Twitter、GitHub、YouTube等の専用情報が取得できる
- [ ] サイト別の自動タグ付けが動作
- [ ] PWAとしてインストールできる

### Phase 5 完了条件（オプション）
- [ ] Twitter API v2 で詳細情報取得できる
- [ ] API使用量が適切に管理されている
- [ ] APIエラー時のフォールバックが動作する
- [ ] ユーザーがAPI機能をON/OFFできる

## リスク・課題と対策

### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| Supabase AuthのRLS設定学習コスト | 低 | 公式ドキュメントでベストプラクティスを参照 |
| Twitter API制限 | 低 | URL解析ベースで基本機能提供、APIは将来オプション |
| Supabase制限 | 高 | 使用量監視、必要に応じて有料プラン |
| パフォーマンス劣化 | 中 | 段階的最適化、監視体制 |

### 開発リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 開発時間の見積もり甘さ | 高 | バッファ時間の確保、MVP重視 |
| 機能過多 | 中 | Phase毎の厳密な優先度付け |
| 品質低下 | 中 | テスト実装、コードレビュー |

## 技術的負債管理

### 許容する負債（MVPフェーズ）
- 包括的なテスト（基本的なテストのみ）
- 完璧なエラーハンドリング
- 国際化対応
- 詳細なログ機能

### 解消すべき負債（Phase 2以降）
- セキュリティ対策の強化
- パフォーマンス最適化
- コード品質改善
- ドキュメント整備

## 成功指標

### 機能的指標
- [ ] 日常的に使用できる安定性
- [ ] 保存から検索まで3クリック以内
- [ ] モバイルでストレスなく操作可能
- [ ] Chrome拡張で5秒以内に保存完了
- [ ] メタデータ取得成功率 95%以上

### 技術的指標
- [ ] ページ表示速度 3秒以内
- [ ] メタデータ取得時間 5秒以内
- [ ] アップタイム 99.5%以上
- [ ] メタデータ取得エラー率 5%以下
- [ ] セキュリティ脆弱性ゼロ

### メタデータ取得品質指標
- [ ] Phase 1（Edge超軽量抽出）成功率: 80%以上
- [ ] Phase 2（Node精度重視）成功率: 95%以上
- [ ] Phase 3（外部APIフォールバック）成功率: 98%以上
- [ ] 特定サイト専用パーサー強化率: 90%以上
- [ ] 外部API依存度: 20%以下を維持

### 日本語検索品質指標
- [ ] Trigram検索精度: 85%以上
- [ ] 検索レスポンス時間: 300ms以内
- [ ] 日本語クエリ適合率: 90%以上