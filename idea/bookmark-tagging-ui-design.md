# ブックマークタグ付けUI設計案

## 概要
ブックマークカードのアクションメニューから開くタグ付けUIの設計提案。ユーザーが快適にタグの選択・作成・削除を行えるインターフェースを目指す。

## UI設計案

### 1. モーダル/ポップオーバー選択
**推奨: ポップオーバー方式**
- BookmarkCardから直接開く軽量なポップオーバー
- モーダルよりも操作感が軽く、複数ブックマークの連続タグ付けに適している
- 画面を覆わないため、他のブックマークとの比較も可能

### 2. レイアウト構成

#### 上部: 現在のタグ表示
```
[📌 仕事] [🎨 デザイン] [📚 学習] [×]
現在のタグが色付きバッジで表示、×ボタンで個別削除可能
```

#### 中央: 検索・入力エリア
```
🔍 [タグを検索または新規作成...           ]
リアルタイム検索 + 新規タグ作成を統合した入力欄
```

#### 下部: タグ候補リスト
```
よく使うタグ:
[プログラミング] [React] [JavaScript] [業務]

すべてのタグ:
[アニメーション] [API設計] [CSS] [データベース]
[Docker] [Figma] [Git] [HTML] [iOS]
```

### 3. インタラクション設計

#### 検索・フィルター
- 入力と同時にリアルタイムでタグリストをフィルタリング
- 部分一致検索（ひらがな・カタカナ・漢字対応）
- 入力テキストが既存タグと一致しない場合「新規作成」オプション表示

#### タグ選択
- クリックで即座にブックマークに追加
- 既に付いているタグは選択状態で表示（チェックマーク付き）
- 選択済みタグをクリックで削除

#### 新規タグ作成
- 検索欄でEnterキー押下で新規タグ作成
- 色選択はクイックカラーピッカー（プリセット色から選択）
- 「+ 新しいタグ "○○○" を作成」ボタン表示

#### 階層タグ対応
- 親タグ選択時は子タグも表示
- パンくずリスト形式での階層表示
- 「プログラミング > React」のような表示

### 4. パフォーマンス最適化

#### データロード
- タグリストは初回のみ取得、その後はキャッシュ
- Supabase Realtimeで他デバイスでの変更を反映
- 楽観的更新でレスポンシブな操作感

#### レンダリング最適化
- 仮想スクロール（タグ数が多い場合）
- デバウンス検索（300ms）
- メモ化されたコンポーネント

### 5. アクセシビリティ

#### キーボード操作
- Tab/Shift+Tab: フォーカス移動
- Enter: タグ選択/作成
- Escape: ポップオーバーを閉じる
- ↑↓: タグリスト内の移動

#### スクリーンリーダー対応
- aria-label/aria-describedbyの適切な設定
- ライブリージョンでタグ追加/削除の読み上げ
- フォーカス管理

### 6. レスポンシブ対応

#### モバイル
- タッチ操作に最適化されたボタンサイズ
- スワイプでタグ削除
- 画面下部固定のシート型UI

#### デスクトップ
- ホバー効果
- 右クリックメニュー
- ドラッグ&ドロップ対応（将来拡張）

### 7. 実装コンポーネント構成

```tsx
BookmarkTagManager/
├── index.tsx              // メインコンポーネント
├── TagSearchInput.tsx     // 検索・新規作成入力
├── CurrentTagsList.tsx    // 現在のタグ表示
├── TagSuggestions.tsx     // タグ候補リスト
├── TagColorPicker.tsx     // 色選択
└── hooks/
    ├── useTagSearch.ts    // 検索ロジック
    ├── useBookmarkTags.ts // ブックマーク-タグ関連操作
    └── useTagManager.ts   // 統合フック
```

### 8. 将来拡張案

#### バッチ操作
- 複数ブックマーク同時選択
- 一括タグ付け機能

#### タグ分析
- よく使うタグの統計表示
- タグの使用頻度に基づく並び替え

#### タグテンプレート
- 定型タグセットの保存・適用
- 「記事系」「ツール系」などのプリセット

#### スマートタグ提案
- URLやタイトルからのAI自動タグ提案
- 類似ブックマークのタグ参照

## 技術的な注意点

### データベース操作
- bookmark_tagsテーブルの効率的なCRUD
- 楽観的更新とRealtime同期の競合回避
- トランザクション処理（複数タグの同時操作）

### 状態管理
- ローカルステートとグローバルステートの適切な分離
- キャッシュ無効化のタイミング制御
- オフライン対応（将来）

### パフォーマンス
- タグ候補の遅延ロード
- 検索結果のページネーション
- メモリリーク対策

この設計により、ユーザーは直感的で高速なタグ付け操作を行えるようになります。